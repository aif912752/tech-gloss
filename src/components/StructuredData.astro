---
// StructuredData Component - Generate JSON-LD structured data
import type { CollectionEntry } from 'astro:content';

export interface Props {
  type: 'website' | 'glossary' | 'term';
  entry?: CollectionEntry<'glossary'>;
  allTerms?: CollectionEntry<'glossary'>[];
}

const { type, entry, allTerms } = Astro.props;
const siteUrl = 'https://techgloss.dev'; // Replace with actual domain

let structuredData: any;

switch (type) {
  case 'website':
    structuredData = {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "TechGloss",
      "description": "คลังคำศัพท์ทางเทคนิคสำหรับนักพัฒนา",
      "url": siteUrl,
      "inLanguage": "th",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": `${siteUrl}/?search={search_term_string}`
        },
        "query-input": "required name=search_term_string"
      },
      "publisher": {
        "@type": "Organization",
        "name": "TechGloss",
        "url": siteUrl,
        "logo": {
          "@type": "ImageObject",
          "url": `${siteUrl}/logo.png`
        }
      }
    };
    break;

  case 'glossary':
    if (allTerms) {
      structuredData = {
        "@context": "https://schema.org",
        "@type": "DefinedTermSet",
        "name": "TechGloss Developer Glossary",
        "description": "คลังคำศัพท์ทางเทคนิคสำหรับนักพัฒนา",
        "url": siteUrl,
        "inLanguage": "th",
        "hasDefinedTerm": allTerms.map(term => ({
          "@type": "DefinedTerm",
          "name": term.data.title,
          "description": term.data.description,
          "url": `${siteUrl}/glossary/${term.slug}`,
          "termCode": term.data.category,
          ...(term.data.lastUpdated && {
            "dateModified": term.data.lastUpdated.toISOString()
          })
        }))
      };
    }
    break;

  case 'term':
    if (entry) {
      structuredData = {
        "@context": "https://schema.org",
        "@type": "DefinedTerm",
        "name": entry.data.title,
        "description": entry.data.description,
        "url": `${siteUrl}/glossary/${entry.slug}`,
        "inDefinedTermSet": {
          "@type": "DefinedTermSet",
          "name": "TechGloss Developer Glossary",
          "description": "คลังคำศัพท์ทางเทคนิคสำหรับนักพัฒนา",
          "url": siteUrl
        },
        "termCode": entry.data.category,
        "inLanguage": "th",
        ...(entry.data.lastUpdated && {
          "dateCreated": entry.data.lastUpdated.toISOString(),
          "dateModified": entry.data.lastUpdated.toISOString()
        }),
        "publisher": {
          "@type": "Organization",
          "name": "TechGloss",
          "url": siteUrl
        },
        // Add breadcrumb navigation
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "หน้าแรก",
              "item": siteUrl
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": entry.data.category,
              "item": `${siteUrl}/?category=${encodeURIComponent(entry.data.category)}`
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": entry.data.title,
              "item": `${siteUrl}/glossary/${entry.slug}`
            }
          ]
        }
      };

      // Add FAQ schema if the term has related terms
      if (entry.data.related && entry.data.related.length > 0) {
        structuredData.mainEntity = {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": `${entry.data.title} คืออะไร?`,
              "acceptedAnswer": {
                "@type": "Answer",
                "text": entry.data.description
              }
            }
          ]
        };
      }
    }
    break;
}
---

{structuredData && (
  <script type="application/ld+json" set:html={JSON.stringify(structuredData, null, 2)} />
)}