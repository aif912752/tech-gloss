---
// SEO Component - Comprehensive meta tags and structured data
import StructuredData from "./StructuredData.astro";
import type { CollectionEntry } from "astro:content";
import { seoConfig, getFullUrl, getImageUrl } from "../config/seo.ts";

export interface Props {
  title: string;
  description: string;
  type?: "website" | "article";
  image?: string;
  imageAlt?: string;
  url?: string;
  publishedTime?: Date;
  modifiedTime?: Date;
  author?: string;
  tags?: string[];
  category?: string;
  noindex?: boolean;
  canonical?: string;
  entry?: CollectionEntry<"glossary">;
  allTerms?: CollectionEntry<"glossary">[];
  structuredDataType?: "website" | "glossary" | "term";
}

const {
  title,
  description,
  type = "website",
  image,
  imageAlt,
  url = Astro.url.href,
  publishedTime,
  modifiedTime,
  author = "TechGloss",
  tags = [],
  category,
  noindex = false,
  canonical,
  entry,
  allTerms,
  structuredDataType = "website",
} = Astro.props;

// Construct full URLs using configuration
const fullUrl = url.startsWith("http") ? url : getFullUrl(url);
const fullImage = image
  ? getImageUrl(image)
  : getImageUrl(seoConfig.defaultOGImage);
const canonicalUrl = canonical || fullUrl;
---

<!-- Basic Meta Tags -->
<title>{title}</title>
<meta name="description" content={description} />
<link rel="canonical" href={canonicalUrl} />

<!-- Robots -->
{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:site_name" content={seoConfig.siteName} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={fullUrl} />
<meta property="og:image" content={fullImage} />
{imageAlt && <meta property="og:image:alt" content={imageAlt} />}
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content={seoConfig.locale} />
{
  seoConfig.facebookAppId && (
    <meta property="fb:app_id" content={seoConfig.facebookAppId} />
  )
}

{
  type === "article" && (
    <>
      {publishedTime && (
        <meta
          property="article:published_time"
          content={publishedTime.toISOString()}
        />
      )}
      {modifiedTime && (
        <meta
          property="article:modified_time"
          content={modifiedTime.toISOString()}
        />
      )}
      {author && <meta property="article:author" content={author} />}
      {category && <meta property="article:section" content={category} />}
      {tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))}
    </>
  )
}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
{
  seoConfig.twitterHandle && (
    <meta name="twitter:site" content={seoConfig.twitterHandle} />
  )
}
{
  seoConfig.twitterHandle && (
    <meta name="twitter:creator" content={seoConfig.twitterHandle} />
  )
}
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImage} />
{imageAlt && <meta name="twitter:image:alt" content={imageAlt} />}

<!-- Additional Meta Tags -->
<meta name="theme-color" content="#22c55e" />
<meta name="msapplication-TileColor" content="#22c55e" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content={seoConfig.siteName} />

<!-- Language and Region -->
<meta name="language" content="th" />
<meta name="geo.region" content="TH" />
<meta name="geo.country" content="Thailand" />
<meta http-equiv="content-language" content="th" />

<!-- Keywords (if tags provided) -->
{tags.length > 0 && <meta name="keywords" content={tags.join(", ")} />}

<!-- Search Engine Verification -->
{seoConfig.googleSiteVerification && (
  <meta name="google-site-verification" content={seoConfig.googleSiteVerification} />
)}
{seoConfig.bingSiteVerification && (
  <meta name="msvalidate.01" content={seoConfig.bingSiteVerification} />
)}
{seoConfig.yandexVerification && (
  <meta name="yandex-verification" content={seoConfig.yandexVerification} />
)}

<!-- Additional SEO Meta Tags -->
<meta name="format-detection" content="telephone=no" />
<meta name="HandheldFriendly" content="true" />
<meta name="MobileOptimized" content="width" />
<meta name="apple-touch-fullscreen" content="yes" />

<!-- Content Security and Cache Control -->
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="referrer" content="strict-origin-when-cross-origin" />

<!-- Dublin Core Metadata -->
<meta name="DC.title" content={title} />
<meta name="DC.description" content={description} />
<meta name="DC.language" content="th" />
<meta name="DC.creator" content={seoConfig.organizationName} />
<meta name="DC.publisher" content={seoConfig.organizationName} />
<meta name="DC.type" content="Text" />
<meta name="DC.format" content="text/html" />

<!-- Additional Open Graph Tags -->
<meta property="og:site_name" content={seoConfig.siteName} />
<meta property="og:locale" content={seoConfig.locale} />
{seoConfig.alternateLocales?.map(locale => (
  <meta property="og:locale:alternate" content={locale} />
))}

<!-- Enhanced Twitter Card -->
<meta name="twitter:domain" content={new URL(seoConfig.siteUrl).hostname} />
<meta name="twitter:url" content={fullUrl} />

<!-- App-specific meta tags -->
<meta name="application-name" content={seoConfig.siteName} />
<meta name="apple-mobile-web-app-title" content={seoConfig.siteName} />
<meta name="msapplication-tooltip" content={description} />
<meta name="msapplication-starturl" content="/" />
<meta name="msapplication-navbutton-color" content="#22c55e" />

<!-- Structured Data -->
<StructuredData type={structuredDataType} entry={entry} allTerms={allTerms} />

<!-- Preconnect to external domains -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- RSS Feed Discovery -->
<link
  rel="alternate"
  type="application/rss+xml"
  title={`${seoConfig.siteName} RSS Feed`}
  href="/rss.xml"
/>

<!-- Sitemap -->
<link
  rel="sitemap"
  type="application/xml"
  title="Sitemap"
  href="/sitemap.xml"
/>

<!-- Humans.txt -->
<link
  rel="author"
  type="text/plain"
  href="/humans.txt"
/>

<!-- Security.txt -->
<link
  rel="security"
  type="text/plain"
  href="/.well-known/security.txt"
/>

<!-- Web App Manifest -->
<link
  rel="manifest"
  href="/manifest.json"
/>

<!-- Apple Touch Icons -->
<link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/apple-touch-icon.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/favicon-16x16.png"
/>

<!-- Microsoft Tiles -->
<meta
  name="msapplication-config"
  content="/browserconfig.xml"
/>
